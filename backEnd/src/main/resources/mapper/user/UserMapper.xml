<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.todoMaster.user.mapper.UserMapper">

	<!-- 이메일 중복 카운트 -->
    <select id="countByEmail" resultType="int">
        SELECT COUNT(*)
        FROM USER_INFO
        WHERE EMAIL = #{email}
    </select>

	 <!-- 회원 삽입 (USER_ID는 SEQ로 처리) -->
    <insert id="insertUser" parameterType="com.todoMaster.user.vo.UserInfoVO">
        INSERT INTO USER_INFO (
            USER_ID, EMAIL, PASSWORD, NICKNAME,
            PROFILE_IMG, PROVIDER, PROVIDER_ID,
            SALT ,REFRESH_TOKEN, CREATED_AT
        )
        VALUES (
            SEQ_USER_ID.NEXTVAL,
            #{email},
            #{password},
            #{nickname},
            #{profileImg},
            #{provider},
            #{providerId},
            #{salt},
            #{refreshToken},
            SYSDATE
        )
    </insert>
    
	<!-- 이메일로 조회 (로그인용) -->
    <select id="findByEmail" resultType="com.todoMaster.user.vo.UserInfoVO">
        SELECT *
        FROM USER_INFO
        WHERE EMAIL = #{email}
    </select>
    
    <!-- 아이디로 조회 -->
    <select id="findById" resultType="com.todoMaster.user.vo.UserInfoVO" parameterType="long">
        SELECT *
        FROM USER_INFO
        WHERE USER_ID = #{userId}
    </select>

    <!-- 리프레시 토큰 업데이트 (로그인 유지/로그아웃) -->
    <update id="updateRefreshToken">
        UPDATE USER_INFO
        SET SALT = #{salt},
        	REFRESH_TOKEN = #{token},
            UPDATED_AT = SYSDATE
        WHERE USER_ID = #{userId}
    </update>
    
    <!-- 회원 정보 수정 -->
    <update id="updateUserInfo">
		UPDATE USER_INFO
		SET
		NICKNAME = #{request.nickname},
		PROFILE_IMG = #{request.profileImg},
		UPDATED_AT = SYSDATE
		WHERE USER_ID = #{userId}
	</update>

	<!-- 비밀번호 수정 -->
	<update id="updatePassword">
		UPDATE USER_INFO
		SET PASSWORD = #{password},
		UPDATED_AT = SYSDATE
		WHERE USER_ID = #{userId}
	</update>

	<!-- 프로필 이미지 수정 -->
	<update id="updateProfileImage">
		UPDATE USER_INFO
		SET PROFILE_IMG = #{profileImg},
		UPDATED_AT = SYSDATE
		WHERE USER_ID = #{userId}
	</update>

</mapper>
